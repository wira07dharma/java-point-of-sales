/*
 Generated by Together */

package com.dimata.aiso.form.jurnal;

// import java
import java.util.*;
import java.util.Date;
import java.sql.*;
import javax.servlet.*;
import javax.servlet.http.*;

// import dimata
import com.dimata.util.*;
import com.dimata.util.lang.I_Language;

// import qdep
import com.dimata.aiso.db.*;
import com.dimata.qdep.form.*;
import com.dimata.qdep.system.*;
import com.dimata.qdep.form.Control;

// import aiso
import com.dimata.aiso.entity.jurnal.*;
import com.dimata.aiso.session.jurnal.SessJurnal;

public class CtrlJurnalDetail extends Control implements I_Language 
{
    public static int RSLT_OK = 0;
    
    public static int INT_JURNAL_NOT_BALANCE = 0;
    public static int INT_JURNAL_NOT_AMOUNT = 1;
    public static String[][] strJurnalBalance = 
    {
        {"Jurnal belum seimbang ...","Jurnal kosong, silakan isi jurnal detailnya ..."},
        {"Journal haven't balance ...","Journal still empty, please fill detail journal ..."}
    };
    
    private int start;
    private String msgString;
    public static String msgBalance;
    private JurnalDetail jurnaldetail;
    private PstJurnalDetail pstJurnalDetail;
    private FrmJurnalDetail frmJurnalDetail;
    private int language= LANGUAGE_DEFAULT;
    
    public CtrlJurnalDetail(HttpServletRequest request) 
    {
        msgString = "";
        jurnaldetail = new JurnalDetail();
        try{
            pstJurnalDetail = new PstJurnalDetail(0);
        }catch(Exception e){}
        frmJurnalDetail = new FrmJurnalDetail(request, jurnaldetail);
    }
    
    public int getLanguage(){ return language; }
    
    public void setLanguage(int language){ this.language = language; }
    
    public JurnalDetail getJurnalDetail() {
        return jurnaldetail;
    }
    
    public FrmJurnalDetail getForm() {
        return frmJurnalDetail;
    }
    
    public String getMessage(){
        return msgString;
    }
    
    public String getMsgBalance(){
        return msgBalance;
    }
    
    public int getStart() {
        return start;
    }
    
    public int action(int cmd) {
        if(cmd==Command.SUBMIT || cmd==Command.ADD){
            frmJurnalDetail.requestEntityObject(jurnaldetail);
        }
        return RSLT_OK;
    }
    
    /** 
     * this method used to posted journal detail
     * this method will called by "CtrlJurnalUmum.journalPosted" method()
     */
    public static int postedJournalDetail(JurnalDetail jurnaldetail){
	return postedJournalDetail(jurnaldetail, null);
    }
    
    public static int postedJournalDetail(JurnalDetail jurnaldetail, Connection con)
    {
        long oid = 0;
        switch(jurnaldetail.getDataStatus())
        {
            case PstJurnalDetail.DATASTATUS_CLEAN :                
                break;
                
            case PstJurnalDetail.DATASTATUS_ADD :                
                try
                {
		    if(con == null){
			oid = PstJurnalDetail.insertExc(jurnaldetail);
		    }else{
			oid = PstJurnalDetail.insertExc(jurnaldetail, null);
		    }
                    int size = jurnaldetail.getDetailLinks().size();
                    if(size>0){
                        jurnaldetail.setGeneralDetailLink(oid);
                        for(int i = 0; i < size; i++){
                            JurnalDetail dLink = jurnaldetail.getDetailLink(i);
                            dLink.setGeneralDetailLink(oid);
                            dLink.setJurnalIndex(jurnaldetail.getJurnalIndex());
                            PstJurnalDetail.insertExc(dLink);
                        }
                        oid = PstJurnalDetail.updateExc(jurnaldetail);
                    }
                }
                catch(DBException dbexc)
                {
                    System.out.println("DBException on CtrlJurnalDetail.postedJournalDetail.DATASTATUS_ADD : " + dbexc.toString());
                }
                catch(Exception exc)
                {
                    System.out.println("Exception on CtrlJurnalDetail.postedJournalDetail.DATASTATUS_ADD : " + exc.toString());
                }
                break;
                
            case PstJurnalDetail.DATASTATUS_UPDATE :                
                try
                {
                    //PstJurnalDetail.deleteByGeneralDetail(jurnaldetail.getOID());
                    int size = jurnaldetail.getDetailLinks().size();
                    if(size>0){
                        jurnaldetail.setGeneralDetailLink(jurnaldetail.getOID());
                        for(int i = 0; i < size; i++){
                            JurnalDetail dLink = jurnaldetail.getDetailLink(i);
                            dLink.setGeneralDetailLink(jurnaldetail.getOID());
                            dLink.setJurnalIndex(jurnaldetail.getJurnalIndex());
                            PstJurnalDetail.insertExc(dLink);
                        }
                    }
		    if(con == null){
			oid = PstJurnalDetail.updateExc(jurnaldetail);
		    }else{
			oid = PstJurnalDetail.updateExc(jurnaldetail, con);
		    }
                }
                catch(DBException dbexc)
                {
                    System.out.println("DBException on CtrlJurnalDetail.postedJournalDetail.DATASTATUS_UPDATE : " + dbexc.toString());
                }
                catch(Exception exc)
                {
                    System.out.println("Exception on CtrlJurnalDetail.postedJournalDetail.DATASTATUS_UPDATE : " + exc.toString());
                }
                break;
                
            case PstJurnalDetail.DATASTATUS_DELETE :                
                try
                {
                    //PstJurnalDetail.deleteByGeneralDetail(jurnaldetail.getOID());
		    if(con == null){
			oid = PstJurnalDetail.deleteExc(jurnaldetail.getOID());
		    }else{
			oid = PstJurnalDetail.deleteExc(jurnaldetail.getOID(), con);
		    }
                }
                catch(DBException dbexc)
                {
                    System.out.println("DBException on CtrlJurnalDetail.postedJournalDetail.DATASTATUS_DELETE : " + dbexc.toString());
                }
                catch(Exception exc)
                {
                    System.out.println("Exception on CtrlJurnalDetail.postedJournalDetail.DATASTATUS_DELETE : " + exc.toString());
                }
                break;
        }
        return 0;
    }    
    
    
}
