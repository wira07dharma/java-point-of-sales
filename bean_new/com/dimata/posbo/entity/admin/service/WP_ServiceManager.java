/* Generated by Together */

package com.dimata.posbo.entity.admin.service;

import java.sql.*;
import java.util.*;
import java.util.Date;
import com.dimata.util.*;
import com.dimata.posbo.db.*;

import com.dimata.posbo.entity.admin.service.*;
//import com.dimata.common.entity.masterdata.*;

public class WP_ServiceManager
    {
    public static int updateServiceConfig(ServiceManager svc)
        {
        try
            {
            String stTime = Formater.formatDate(svc.getStartTime(), "yyyy-MM-dd k:mm:ss");
            String sql = "";
            if (checkServiceConfig())
                {
                System.out.println("updating configurations...");
                sql = "UPDATE BACK_UP_CONF SET START_TIME=DATE_FORMAT('" + stTime + "','%Y-%m-%d %T'),PERIODE=" +
                    svc.getPeriode() + ",TARGET1='" + svc.getTargetDir1() + "',TARGET2='" + svc.getTargetDir2() +
                    "',TARGET3='" + svc.getTargetDir3() + "',SOURCE_PATH='" + svc.getSourceDir() + "'";
                System.out.println(sql);
                }
            else
                {
                System.out.println("adding configurations...");
                sql = "INSERT INTO BACK_UP_CONF VALUES(DATE_FORMAT('" + stTime + "','%Y-%m-%d %T')," + svc.getPeriode() +
                    ",'" + svc.getTargetDir1() + "','" + svc.getTargetDir2() + "','" + svc.getTargetDir3() +"' ,SOURCE_PATH='" + svc.getSourceDir() + "')";

                }
            return DBHandler.execUpdate(sql);
            }
        catch (Exception e)
            {
            System.out.println(e);
            return -1;
            }
        }


    public static ServiceManager fetchServiceConfig()
        {
        ServiceManager svc = new ServiceManager();
        BackUpService backup = new BackUpService();
        String sql = "SELECT * FROM BACK_UP_CONF";

        DBResultSet dbrs = null;
        try{
                 dbrs = DBHandler.execQueryResult(sql);
                 ResultSet rs = dbrs.getResultSet();
                 while(rs.next()){
                     PstBackUpService.resultToObject(rs, backup);
                 }

                svc.setStartTime(backup.getStartTime());
                svc.setPeriode(backup.getPeriode());
                svc.setTargetDir1(backup.getTarget1());
                svc.setTargetDir2(backup.getTarget2());
                svc.setTargetDir3(backup.getTarget3());
                svc.setSourceDir(backup.getSourcePath());

                rs.close();

        }catch (Exception e) {
            DBResultSet.close(dbrs);
            System.out.println("exception : "+e.toString());
            return null;
        }
        finally{
            DBResultSet.close(dbrs);
            return svc;
        }
    }

    public static boolean checkServiceConfig() throws Exception
        {
        String sql = "SELECT COUNT(PERIODE)AS TOTAL FROM BACK_UP_CONF";

        DBResultSet dbrs = null;
        int count = 0;
        try{
            dbrs = DBHandler.execQueryResult(sql);
            ResultSet rs = dbrs.getResultSet();
            while (rs.next()){
                count = rs.getInt(1);
            }
            rs.close();
        }
        catch(Exception e){
            DBResultSet.close(dbrs);
            System.out.println("Exception : "+e.toString());
        }
        finally{
         	DBResultSet.close(dbrs);
        }

        if (count > 0)
            return true;
        else
            return false;
        }
    }
